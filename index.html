<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Foodfuckers 2017</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick.css/">
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/jquery.slick/1.6.0/slick-theme.css"/>
    <link rel="stylesheet" href="./index.css">

    <!-- <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"> -->
    <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.23/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-bootstrap/0.31.0/react-bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-slick/0.14.10/react-slick.min.js"></script>
    <script src="https://use.typekit.net/kme7pgt.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script>
    <script type="text/javascript">

    </script>
    <script type="text/jsx" src='/index.jsx'>
    </script>
    <meta name = "viewport" id = "viewport_device">

  </head>
  <body>

    <div class="container">
      <div class="responsive-img centered">
        <img class="img-responsive" style="min-height: 120px; width: 100%;" src="./foodfuckers_logo.png"></img>
      </div>
      <div class="headerContent">
        <!--
        <h2> Current Intended Location </h2>
        <h3 id="location">Home</h3>
          <h4> Address <span id="locationAddress"></span></h4>
          <h4> Store hours </h4>
        <h2> Duration of Stay: <span id="duration"></span> </h2>
        <h3> Next location: <span id="nextLocation"></span> </h3> -->
      </div>
      <!-- <div class="schedule-list">
        <h1>Today's Schedule:</h1>
        <ul id="schedule">
        </ul>
      </div> -->
    </div>

    <div id="app">
    </div>



      <div id="restaurantList">
      </div>
      <script type="text/javascript">
      if(navigator.userAgent.match(/iPhone/i) || navigator.userAgent.match(/iPod/i) || navigator.userAgent.match(/Android/i)
        || navigator.userAgent.match(/BlackBerry/i) || navigator.userAgent.match(/IEMobile/i)){
            $("#viewport_device").attr("content", "initial-scale = 0.50");
        }
        else if(navigator.userAgent.match(/iPad/i)){
            $("#viewport_device").attr("content", "initial-scale = 1.00");
        }
      </script>
      <script type="text/babel">
      //TODO:
        // Build overview that shows all restaurants
        // Build invidiual info pages
        // Connect these two somehow
        // Split up overview pages into carousel slides
        // Add Time Control
        // Figure out how to show other days

      //Whole Page
      var Slider = window.Slider.default
      var {Accordion,
        Panel} = ReactBootstrap


      var App = React.createClass({
        getInitialState: function() {
          return {}
        },
        componentWillMount: function() {
          var that = this
          $.get("/FoodStuff2017/restaurants.json", function(res) {
            that.setState({restaurants: res})
          })
          $.get("/FoodStuff2017/schedule.json", function(res) {
            that.setState({schedule: res})
          })

        },
        // <Overview restaurants={this.state.restaurants}/>
        render: function() {
          return (
            <div>
            <DayCounter/>
            <CurrentItinerary restaurants={this.state.restaurants} schedule={this.state.schedule}/>
            <br/>
            <br/>
            <div id="container " style={{"textAlign":"center"}}>
              <iframe src="https://kiwiirc.com/client/irc.kiwiirc.com/#foodfuckers2017" style={{"border":"0", "width":"90%", "height":"500px", "margin":" 0 auto"}}></iframe>
            </div>
            <Footer/>
            </div>
          )
        }
      })
      // <div className="map-responsive to-da-floor">
      //   <iframe src="https://www.google.com/maps/d/embed?mid=1ApYMY1h5S5O3NZiO6Eu1Uy3TUaU" width="600" height="450" frameBorder="0" style={{"border": "0"}} allowFullScreen></iframe>
      // </div>

      var OverviewItem = React.createClass({
        createOverviewItem: function(current) {
          console.log(current);
        if (current.hours) {
          if (current.hours.weekday_text) {
            var i = this.props.index
            var weekday_texts = [
              <h5 key={"weekday_text"+[i]+"1"}>{current.hours.weekday_text[0]}</h5>,
              <h5 key={"weekday_text"+[i]+"2"}>{current.hours.weekday_text[1]}</h5>,
              <h5 key={"weekday_text"+[i]+"3"}>{current.hours.weekday_text[2]}</h5>,
              <h5 key={"weekday_text"+[i]+"4"}>{current.hours.weekday_text[3]}</h5>,
              <h5 key={"weekday_text"+[i]+"5"}>{current.hours.weekday_text[4]}</h5>,
              <h5 key={"weekday_text"+[i]+"6"}>{current.hours.weekday_text[5]}</h5>,
              <h5 key={"weekday_text"+[i]+"7"}>{current.hours.weekday_text[6]}</h5>,
            ]
          } else {
            var weekday_texts = [
              <h5 key="nope"> No hours! </h5>
            ]
          }
        }
        var directionsLink = "https://www.google.com/maps/dir/?api=1&destination=" + encodeURIComponent(current.address)

        return {weekday_texts:weekday_texts, directionsLink:directionsLink}
      },
        render: function() {
          var current = this.props.current
          var content = this.createOverviewItem(current)
          var i = this.props.index

          return(
            <Accordion>
              <Panel header={current.name} key={i} eventKey={i} bsStyle={{"border":'none', "background-color":'none', 'box-shadow':'none' }}>
              <div>
                <a href={content.directionsLink}><h5>{current.address}</h5></a>
                {content.weekday_texts}
                <br/>
              </div>
              </Panel>
          </Accordion>
          )
        }

      })
      var Overview = React.createClass({
        createOverview: function() {

          if (typeof this.props.restaurants != 'undefined'){
          var content = []
          var restaurants = this.props.restaurants
          var keys = Object.keys(restaurants)


          return (
            <Accordion>
              {content}
            </Accordion>
          )
        } else {
          return(
            <div style={{'textAlign':'center'}}>
              <br/>
              Loading...
            </div>
          )
        }

        },
        render: function() {
          var contentList = this.createOverview();
          return(
            <div className="container overview">
              {contentList}
            </div>
          )
        }
      })

      var Footer = React.createClass({
        render: function() {
          return (
            <div className="container">
              <h5>Created by Andrew Tae</h5>
              <h5> <a href="http://www.github.com/atae">Github</a> | <a href="https://www.linkedin.com/in/andrew-tae/">LinkedIn</a> | <a href="mailto:andrewtae368@gmail.com">Email</a> </h5>
            </div>
          )
        }
      })

      var DayCounter = React.createClass({
        getInitialState: function() {
          return {currentTime: new Date()}
        },
        componentDidMount: function() {
          var that = this
          setInterval(function() {
            var time = new Date()
            that.setState({currentTime: time})
          }, 1000)
        }
        ,
        getDays: function() {
          var deadline = new Date(2016, 6, 21, 0, 0, 0)
          var lastDay = new Date(2016, 6, 24, 0, 0, 0)
          var currentDay = new Date()
          var message = []
          if (currentDay.getDate() < deadline.getDate()) {
              var daysLeft = deadline.getDate() - currentDay.getDate()
              return(
                  <h3> Only <b>{daysLeft}</b> days left!</h3>
                )
          } else if (currentDay.getDate() > lastDay.getDate()) {
              return(
                  <h3> Done! Go <b>Home</b>! </h3>
                  )
          } else {
              var day =  currentDay.getDate() - deadline.getDate() + 1
              return(
                  <h3> Day <b>{day}</b></h3>
                  )
          }
        },
        render: function() {
          var timeContent = this.getDays()
          var currentTime = this.state.currentTime
          var hour = currentTime.getHours()
          var minutes = currentTime.getMinutes()
          var seconds = currentTime.getSeconds()
          var displayHour = hour%12
          displayHour = (displayHour == 0) ? 12 : displayHour
          var displayMinutes = ("0" + minutes).slice(-2)
          var displaySeconds = ("0" + seconds).slice(-2)
          var ampm = (hour >= 12) ? "PM" : "AM"
          return (
            <div>
              {timeContent}
              <h3>{displayHour} : {displayMinutes} : {displaySeconds} {ampm}</h3>
              <br/>
            </div>

          )
        }
      })

      var cache = []

      var CurrentItinerary = React.createClass({
        getInitialState: function() {
          return {
            intialSlide: this.getSlide(),
          }
        },
        getSlide: function() {
          return 0;
        },
        createHours: function() {
          var content = []
          if (this.props.schedule) {
            // if (content.length == 0) {
              console.log("Cache length is " + cache.length);
              console.log(content)
              console.log(this.props.schedule);
            var keys = Object.keys(this.props.schedule)
            for (var i = 0; i < keys.length - 1; i++) {
              var currentDay = this.props.schedule[keys[i]]
              var dates = Object.keys(currentDay)

              for (var j = 0; j < dates.length; j++) {
                if (dates[j] != "Time") {
                content = content.concat([<div key={dates[j] + i }>
                  <ItineraryContent restaurants = {this.props.restaurants} required={this.props.schedule['Required Places']} hour = {dates[j]} hourContent={currentDay[dates[j]]} day={currentDay[dates[0]]}/>
                </div>])
              // }
              }
            }
            // cache = content
          }
        }
          return content
        },
        handleClick: function(e) {
          this.setState({initialSlide: e.target.id})
        },
        createNavButtons: function() {
          var daysToSlide = {
            "Fri" : 0,
            "Sat" : 19,
            "Sun" : 38,
            "Mon" : 57
          }

          var content = []
          var days = ["Fri", "Sat", "Sun", "Mon"]

          if(this.props.schedule) {
          for (var i = 0; i < days.length; i++) {
            if (i==0){
              content = content.concat(<span id={daysToSlide[days[i]]} onClick={this.handleClick}>Fri </span>)
            } else {
              content = content.concat(<span id={daysToSlide[days[i]]} onClick={this.handleClick}>{"·" + days[i]}</span>)
            }
          }
          }
          return content
        },
        render: function() {
          var settings = {
            infinite: true,
            speed: 100,
            slidesToShow: 1,
            slidesToScroll: 1,
            accessibility: true,
            centerMode: true,
            swipeToSlide: true,
            slickGoTo: this.state.initialSlide
          };

          var content = this.createHours()
          var navButtons = this.createNavButtons()
          //Add some dots to jump to dates (intialSlide = 21 for saturday) (slickGoTo(21),
          // see example https://github.com/akiran/react-slick/blob/master/examples/SlickGoTo.js)
          //Also add whole day schedule somewhere
          // Need Exact keys : DONE
          return(
            <div className="container" style={{"width":"80%"}}>
                {content.length > 0 ? <Slider ref="slider" {...settings}>{content}</Slider>: <div></div>}
            <br/>
            <div className="schedule-nav">
              {navButtons}
              </div>
            <p> Tap on the Place Name for details </p>
            <p> The * means we goin fo sho </p>
            </div>
          )
        }
      })

// {"ROAD TRIP CREW ARRIVAL": {
//   "name":"",
//   "hours": {
//     "weekday_text": []
//   },
//   "address": "",
//   "phone": "",
//   "site": ""
// },
// "ROAD TRIP CREW TO LA" : {
//
// },
// "FLIGHT CREW ARRIVAL" : {
//
// },
// "Hotel Check-in" : {
//
// },
// "Meet up at Hotel" : {
//
// },
// "DRIVE TO ONTARIO (50min)": {
//
// },
// "DRIVE TO PHM (25-30min)": {
//
// },
// "PHM Round 1": {
//
// },
// "LEAVE TO 626 NM (25-30min)": {
//
// },
// "purikura" : {
//
// },
// "Venice Beach" : {
//
// }

      var ItineraryContent = React.createClass({
        getInitialState: function() {
          return {}
        },
        createItineraryContent: function() {
          var restaurantsObject = {}
          var content = []
          if (typeof this.props.restaurants != "undefined") {
            var keys = Object.keys(this.props.restaurants)
            for (var i = 0; i < this.props.hourContent.length; i++) {
              if (keys.includes(this.props.hourContent[i])){
                restaurantsObject = this.props.restaurants[this.props.hourContent[i]]
                content = content.concat(<OverviewItem index={i} current={restaurantsObject} />)
              } else {
                console.log(this.props.hourContent[i]);
                content = content.concat(<h4> {this.props.hourContent[i]} </h4>)
              }
            }
          }

            for (var i = 0; i < this.props.hourContent.length; i++) {
              //
              // if (this.props.required.includes(this.props.hourContent[i])) {
              //   // content = content.concat(<h4>{"*" + this.props.hourContent[i]}</h4>)
              // } else {
              //   content = content.concat(<h4>{this.props.hourContent[i]}</h4>)
              // }
            }
          return content
        },
        render: function() {
          var hourContents = this.createItineraryContent()
          return(
            <div className="carousel-box">
              <h2> {this.props.day} </h2>
              <h3> {this.props.hour} </h3>
              {hourContents}

            </div>
          )
        }
      })
        var app = document.getElementById('app')
        ReactDOM.render(<App />, app)

      </script>
  </body>
</html>
